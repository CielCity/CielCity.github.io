<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.useso.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="DUBBO是一个分布式服务框架，致力于提供高性能和透明化的RPC远程服务调用方案，是阿里巴巴SOA服务化治理方案的核心框架，每天为2,000+个服务提供3,000,000,000+次访问量支持，并被广泛应用于阿里巴巴集团的各成员站点。
介绍Dubbo背景大规模服务化之前，应用可能只是通过RMI或Hessian等工具，简单的暴露和引用远程服务，通过配置服务的URL地址进行调用，通过F5等硬件进行负载">
<meta property="og:type" content="article">
<meta property="og:title" content="Dubbo与Zookeeper、SpringMVC整合和使用（负载均衡、容错）">
<meta property="og:url" content="http://CielCity.github.io/2017/02/17/Dubbo详解/index.html">
<meta property="og:site_name" content="CielCity">
<meta property="og:description" content="DUBBO是一个分布式服务框架，致力于提供高性能和透明化的RPC远程服务调用方案，是阿里巴巴SOA服务化治理方案的核心框架，每天为2,000+个服务提供3,000,000,000+次访问量支持，并被广泛应用于阿里巴巴集团的各成员站点。
介绍Dubbo背景大规模服务化之前，应用可能只是通过RMI或Hessian等工具，简单的暴露和引用远程服务，通过配置服务的URL地址进行调用，通过F5等硬件进行负载">
<meta property="og:image" content="http://static.oschina.net/uploads/img/201110/30093737_2LhG.jpg">
<meta property="og:image" content="http://img.blog.csdn.net/20141114081515468?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY29uZ2Nvbmc2OA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center">
<meta property="og:image" content="http://img.blog.csdn.net/20141114081527231?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY29uZ2Nvbmc2OA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center">
<meta property="og:image" content="http://img.blog.csdn.net/20141114081600156?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY29uZ2Nvbmc2OA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center">
<meta property="og:image" content="http://img.blog.csdn.net/20141114081552940?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY29uZ2Nvbmc2OA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center">
<meta property="og:image" content="http://img.blog.csdn.net/20141114081605560?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY29uZ2Nvbmc2OA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center">
<meta property="og:image" content="http://img.blog.csdn.net/20141114081622190?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY29uZ2Nvbmc2OA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center">
<meta property="og:image" content="http://img.blog.csdn.net/20141114081644014?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY29uZ2Nvbmc2OA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center">
<meta property="og:image" content="http://img.blog.csdn.net/20141114081659536?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY29uZ2Nvbmc2OA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center">
<meta property="og:image" content="http://img.blog.csdn.net/20141114081750156?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY29uZ2Nvbmc2OA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center">
<meta property="og:image" content="http://img.blog.csdn.net/20141114081749612?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY29uZ2Nvbmc2OA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center">
<meta property="og:image" content="http://img.blog.csdn.net/20141114081802935?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY29uZ2Nvbmc2OA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center">
<meta property="og:updated_time" content="2017-02-17T06:16:08.208Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Dubbo与Zookeeper、SpringMVC整合和使用（负载均衡、容错）">
<meta name="twitter:description" content="DUBBO是一个分布式服务框架，致力于提供高性能和透明化的RPC远程服务调用方案，是阿里巴巴SOA服务化治理方案的核心框架，每天为2,000+个服务提供3,000,000,000+次访问量支持，并被广泛应用于阿里巴巴集团的各成员站点。
介绍Dubbo背景大规模服务化之前，应用可能只是通过RMI或Hessian等工具，简单的暴露和引用远程服务，通过配置服务的URL地址进行调用，通过F5等硬件进行负载">
<meta name="twitter:image" content="http://static.oschina.net/uploads/img/201110/30093737_2LhG.jpg">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>

  <title> Dubbo与Zookeeper、SpringMVC整合和使用（负载均衡、容错） | CielCity </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">CielCity</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">cielCity</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404.html" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            公益404
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Dubbo与Zookeeper、SpringMVC整合和使用（负载均衡、容错）
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-02-17T10:54:55+08:00" content="2017-02-17">
              2017-02-17
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>DUBBO是一个分布式服务框架，致力于提供高性能和透明化的RPC远程服务调用方案，是阿里巴巴SOA服务化治理方案的核心框架，每天为2,000+个服务提供3,000,000,000+次访问量支持，并被广泛应用于阿里巴巴集团的各成员站点。</p>
<h2 id="介绍Dubbo背景"><a href="#介绍Dubbo背景" class="headerlink" title="介绍Dubbo背景"></a>介绍Dubbo背景</h2><p>大规模服务化之前，应用可能只是通过RMI或Hessian等工具，简单的暴露和引用远程服务，通过配置服务的URL地址进行调用，通过F5等硬件进行负载均衡。</p>
<h3 id="1-当服务越来越多时，服务URL配置管理变得非常困难，F5硬件负载均衡器的单点压力也越来越大。"><a href="#1-当服务越来越多时，服务URL配置管理变得非常困难，F5硬件负载均衡器的单点压力也越来越大。" class="headerlink" title="(1) 当服务越来越多时，服务URL配置管理变得非常困难，F5硬件负载均衡器的单点压力也越来越大。"></a>(1) 当服务越来越多时，服务URL配置管理变得非常困难，F5硬件负载均衡器的单点压力也越来越大。</h3><p>此时需要一个服务注册中心，动态的注册和发现服务，使服务的位置透明。<br>并通过在消费方获取服务提供方地址列表，实现软负载均衡和Failover，降低对F5硬件负载均衡器的依赖，也能减少部分成本。</p>
<h3 id="2-当进一步发展，服务间依赖关系变得错踪复杂，甚至分不清哪个应用要在哪个应用之前启动，架构师都不能完整的描述应用的架构关系。"><a href="#2-当进一步发展，服务间依赖关系变得错踪复杂，甚至分不清哪个应用要在哪个应用之前启动，架构师都不能完整的描述应用的架构关系。" class="headerlink" title="(2) 当进一步发展，服务间依赖关系变得错踪复杂，甚至分不清哪个应用要在哪个应用之前启动，架构师都不能完整的描述应用的架构关系。"></a>(2) 当进一步发展，服务间依赖关系变得错踪复杂，甚至分不清哪个应用要在哪个应用之前启动，架构师都不能完整的描述应用的架构关系。</h3><p>这时，需要自动画出应用间的依赖关系图，以帮助架构师理清理关系。</p>
<h3 id="3-接着，服务的调用量越来越大，服务的容量问题就暴露出来，这个服务需要多少机器支撑？什么时候该加机器？"><a href="#3-接着，服务的调用量越来越大，服务的容量问题就暴露出来，这个服务需要多少机器支撑？什么时候该加机器？" class="headerlink" title="(3) 接着，服务的调用量越来越大，服务的容量问题就暴露出来，这个服务需要多少机器支撑？什么时候该加机器？"></a>(3) 接着，服务的调用量越来越大，服务的容量问题就暴露出来，这个服务需要多少机器支撑？什么时候该加机器？</h3><p>为了解决这些问题，第一步，要将服务现在每天的调用量，响应时间，都统计出来，作为容量规划的参考指标。<br>其次，要可以动态调整权重，在线上，将某台机器的权重一直加大，并在加大的过程中记录响应时间的变化，直到响应时间到达阀值，记录此时的访问量，再以此访问量乘以机器数反推总容量。</p>
<h2 id="Dubbo的简介"><a href="#Dubbo的简介" class="headerlink" title="Dubbo的简介"></a>Dubbo的简介</h2><p>Dubbo是一个分布式服务框架,解决了上面的所面对的问题，Dubbo的架构如图所示：<img src="http://static.oschina.net/uploads/img/201110/30093737_2LhG.jpg" alt=""></p>
<h3 id="节点角色说明："><a href="#节点角色说明：" class="headerlink" title="节点角色说明："></a>节点角色说明：</h3><ul>
<li>Provider: 暴露服务的服务提供方。</li>
<li>Consumer: 调用远程服务的服务消费方。</li>
<li>Registry: 服务注册与发现的注册中心。</li>
<li>Monitor: 统计服务的调用次调和调用时间的监控中心。</li>
<li>Container: 服务运行容器。</li>
</ul>
<h3 id="调用关系说明："><a href="#调用关系说明：" class="headerlink" title="调用关系说明："></a>调用关系说明：</h3><ol>
<li>服务容器负责启动，加载，运行服务提供者。</li>
<li>服务提供者在启动时，向注册中心注册自己提供的服务。</li>
<li>服务消费者在启动时，向注册中心订阅自己所需的服务。</li>
<li>注册中心返回服务提供者地址列表给消费者，如果有变更，注册中心将基于长连接推送变更数据给消费者。</li>
<li>服务消费者，从提供者地址列表中，基于软负载均衡算法，选一台提供者进行调用，如果调用失败，再选另一台调用。</li>
<li>服务消费者和提供者，在内存中累计调用次数和调用时间，定时每分钟发送一次统计数据到监控中心。</li>
</ol>
<p>我们之前没用Dubbo之前时，大部分都使用Hessian来使用我们服务的暴露和调用，利用HessianProxyFactory调用远程接口。</p>
<p>上面是参考了Dubbo官方网介绍，接下来我们来介绍SpringMVC、Dubbo、Zookeeper整合使用。</p>
<h2 id="Dubbo与Zookeeper、SpringMVC整合使用"><a href="#Dubbo与Zookeeper、SpringMVC整合使用" class="headerlink" title="Dubbo与Zookeeper、SpringMVC整合使用"></a>Dubbo与Zookeeper、SpringMVC整合使用</h2><h3 id="第一步：在Linux上安装Zookeeper"><a href="#第一步：在Linux上安装Zookeeper" class="headerlink" title="第一步：在Linux上安装Zookeeper"></a>第一步：在Linux上安装Zookeeper</h3><p> Zookeeper作为Dubbo服务的注册中心，Dubbo原先基于数据库的注册中心，没采用Zookeeper，Zookeeper一个分布式的服务框架，是树型的目录服务的数据存储，能做到集群管理数据 ，这里能很好的作为Dubbo服务的注册中心，Dubbo能与Zookeeper做到集群部署，当提供者出现断电等异常停机时，Zookeeper注册中心能自动删除提供者信息，当提供者重启时，能自动恢复注册数据，以及订阅请求。我们先在linux上安装Zookeeper，我们安装最简单的单点，集群比较麻烦。</p>
<ol>
<li>下载Zookeeper-3.4.6.tar.gz  地址<a href="http://www.apache.org/dist/zookeeper/" target="_blank" rel="external">http://www.apache.org/dist/zookeeper/</a></li>
<li>我们放到Linux下的一个文件夹，然后解压：<br>   #tar zxvf zookeeper-3.4.6.tar.gz</li>
<li>然后在对应的zookeeper-3.4.6/conf 下有一个文件zoo_sample.cfg的这个文件里面配置了监听客户端连接的端口等一些信息，Zookeeper 在启动时会找zoo.cfg这个文件作为默认配置文件,所以我们复制一个名称为zoo.cfg的文件，如图所示：<img src="http://img.blog.csdn.net/20141114081515468?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY29uZ2Nvbmc2OA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="">                                            </li>
</ol>
<pre><code>我们查看一下这个文件的里面的一些配置信息，如图所示:  
</code></pre><p><img src="http://img.blog.csdn.net/20141114081527231?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY29uZ2Nvbmc2OA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""></p>
<pre><code>说明：

clientPort：监听客户端连接的端口。
tickTime：基本事件单元，以毫秒为单位。它用来控制心跳和超时，默认情况下最小的会话超时时间为两倍的 tickTime。

  我们可以对配置文件的端口等或者进行高级配置和集群配置例如：maxclientcnxns：限制连接到 zookeeper 的客户端的数量等
</code></pre><ol>
<li><p>启动Zookeeper 的服务，如图所示：                                                                                    </p>
<p> <img src="http://img.blog.csdn.net/20141114081600156?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY29uZ2Nvbmc2OA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""><br> 到这边Zookeeper的安装和配置完成</p>
<h3 id="第二步：配置dubbo-admin的管理页面，方便我们管理页面"><a href="#第二步：配置dubbo-admin的管理页面，方便我们管理页面" class="headerlink" title="第二步：配置dubbo-admin的管理页面，方便我们管理页面"></a>第二步：配置dubbo-admin的管理页面，方便我们管理页面</h3><ol>
<li>下载dubbo-admin-2.4.1.war包，在Linux的tomcat部署，先把dubbo-admin-2.4.1放在tomcat的webapps/ROOT下，然后进行解压：      #jar -xvf dubbo-admin-2.4.1.war</li>
<li>然后到webapps/ROOT/WEB-INF下，有一个dubbo.properties文件，里面指向Zookeeper ，使用的是Zookeeper 的注册中心，如图所示：<br><img src="http://img.blog.csdn.net/20141114081552940?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY29uZ2Nvbmc2OA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""></li>
<li><p>然后启动tomcat服务，用户名和密码：root,并访问服务，显示登陆页面，说明dubbo-admin部署成功，如图所示：<br><img src="http://img.blog.csdn.net/20141114081605560?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY29uZ2Nvbmc2OA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""></p>
<h3 id="第三步：SpringMVC与Dubbo的整合，这边使用的Maven的管理项目"><a href="#第三步：SpringMVC与Dubbo的整合，这边使用的Maven的管理项目" class="headerlink" title="第三步：SpringMVC与Dubbo的整合，这边使用的Maven的管理项目"></a>第三步：SpringMVC与Dubbo的整合，这边使用的Maven的管理项目</h3><ol>
<li><p>我们先开发服务注册的，就是提供服务，项目结构如图所示：<br><img src="http://img.blog.csdn.net/20141114081622190?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY29uZ2Nvbmc2OA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""><br>(1)test-maven-api项目加入了一个服务接口，代码如下：</p>
<p>public interface TestRegistryService {<br>   public String hello(String name);<br>}<br>(2)test-maven-console在pom.xml加入Dubbo和Zookeeper的jar包、引用test-maven-api的jar包，代码如下：</p>
<p><dependency><br>  <groupid>cn.test</groupid><br>  <artifactid>test-maven-api</artifactid><br>  <version>0.0.1-SNAPSHOT</version><br></dependency><br><dependency><br>  <groupid>com.alibaba</groupid><br>  <artifactid>dubbo</artifactid><br>  <version>2.5.3</version><br></dependency><br><dependency><br>  <groupid>org.apache.zookeeper</groupid><br>  <artifactid>zookeeper</artifactid><br>  <version>3.4.6</version><br></dependency><br><dependency><br>  <groupid>com.github.sgroschupf</groupid><br>  <artifactid>zkclient</artifactid><br>  <version>0.1</version><br></dependency><br>(3)test-maven-console实现具体的服务，代码如下：</p>
<p>@Service(“testRegistryService”)<br>ublic class TestRegistryServiceImpl implements TestRegistryService {<br>public String hello(String name) {<br>  return “hello”+name;<br>}  </p>
</li>
</ol>
</li>
</ol>
</li>
</ol>
<p>(4)我们服务以及实现好了，这时要暴露服务，代码如下：</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;  
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot; 
 xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;   
    xmlns:jee=&quot;http://www.springframework.org/schema/jee&quot;  
    xmlns:tx=&quot;http://www.springframework.org/schema/tx&quot;  
    &lt;span style=&quot;color:#cc0000;&quot;&gt;xmlns:dubbo=&quot;http://code.alibabatech.com/schema/dubbo&quot;&lt;/span&gt;  
    xmlns:context=&quot;http://www.springframework.org/schema/context&quot;  
    xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.1.xsd  
    http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-3.1.xsd  
    http://www.springframework.org/schema/jee http://www.springframework.org/schema/jee/spring-jee-3.1.xsd  
    &lt;span style=&quot;color:#990000;&quot;&gt;http://code.alibabatech.com/schema/dubbo http://code.alibabatech.com/schema/dubbo/dubbo.xsd&lt;/span&gt;  
    http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.1.xsd&quot;  
    default-lazy-init=&quot;false&quot; &gt;  
   &lt;!-- 提供方应用名称信息，这个相当于起一个名字，我们dubbo管理页面比较清晰是哪个应用暴露出来的 --&gt;  
   &lt;dubbo:application name=&quot;dubbo_provider&quot;&gt;&lt;/dubbo:application&gt;  
   &lt;!-- 使用zookeeper注册中心暴露服务地址 --&gt;    
   &lt;dubbo:registry address=&quot;zookeeper://127.0.0.1:2181&quot; check=&quot;false&quot; subscribe=&quot;false&quot; register=&quot;&quot;&gt;&lt;/dubbo:registry&gt;  
  &lt;!-- 要暴露的服务接口 --&gt;    
  &lt;dubbo:service interface=&quot;cn.test.dubbo.registry.service.TestRegistryService&quot; ref=&quot;testRegistryService&quot; /&gt;        
&lt;/beans&gt;
</code></pre><p>说明：  </p>
<p>dubbo:registry 标签一些属性的说明： </p>
<p>1）register是否向此注册中心注册服务，如果设为false，将只订阅，不注册。<br>2）check注册中心不存在时，是否报错。<br>3）subscribe是否向此注册中心订阅服务，如果设为false，将只注册，不订阅。<br>4）timeout注册中心请求超时时间(毫秒)。<br> 5）address可以Zookeeper集群配置，地址可以多个以逗号隔开等。  </p>
<p>dubbo:service标签的一些属性说明：   </p>
<p>1）interface服务接口的路径<br>2）ref引用对应的实现类的Bean的ID<br>3）registry向指定注册中心注册，在多个注册中心时使用，值为<dubbo:registry>的id属性，多个注册中心ID用逗号分隔，如果不想将该服务注册到任何registry，可将值设为N/A<br>4）register 默认true ，该协议的服务是否注册到注册中心。</dubbo:registry></p>
<p>(5)启动项目，然后我们在Dubbo管理页面上显示，已经暴露的服务，但显示还没有消费者，因为我们还没实现消费者服务，如图所示：<br><img src="http://img.blog.csdn.net/20141114081644014?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY29uZ2Nvbmc2OA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="">  </p>
<p>2.我们在开发服务消费者，就是调用服务，我们在新建一个新的消费者项目结构如图所示：<br><img src="http://img.blog.csdn.net/20141114081659536?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY29uZ2Nvbmc2OA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""><br>（1）test-maven-server-console的pom.xml引入Dubbo和Zookeeper的jar包、test-maven-api的jar包，因为引入test-maven-api的jar包，我们在项目中调用像在本地调用一样。代码如下：</p>
<pre><code>&lt;dependency&gt;  
    &lt;groupId&gt;cn.test&lt;/groupId&gt;  
    &lt;artifactId&gt;test-maven-api&lt;/artifactId&gt;  
    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;  
&lt;/dependency&gt;  
&lt;dependency&gt;  
    &lt;groupId&gt;com.alibaba&lt;/groupId&gt;  
    &lt;artifactId&gt;dubbo&lt;/artifactId&gt;  
    &lt;version&gt;2.5.3&lt;/version&gt;  
&lt;/dependency&gt;  
&lt;dependency&gt;  
    &lt;groupId&gt;org.apache.zookeeper&lt;/groupId&gt;  
    &lt;artifactId&gt;zookeeper&lt;/artifactId&gt;  
    &lt;version&gt;3.4.6&lt;/version&gt;  
&lt;/dependency&gt;  
&lt;dependency&gt;  
    &lt;groupId&gt;com.github.sgroschupf&lt;/groupId&gt;  
    &lt;artifactId&gt;zkclient&lt;/artifactId&gt;  
    &lt;version&gt;0.1&lt;/version&gt;  
&lt;/dependency&gt;    
</code></pre><p>  （2）test-maven-server-console项目的具体实现，代码如下：</p>
<pre><code>@Controller  
public class IndexController {  

    @Autowired  
    private TestRegistryService testRegistryService;  

    @RequestMapping(&quot;/hello&quot;)  
    public String index(Model model){  
         String name=testRegistryService.hello(&quot;zz&quot;);  
         System.out.println(&quot;xx==&quot;+name);  
        return &quot;&quot;;  
    }  

}   
</code></pre><p>(3)我们要引用的地址，代码如下：  </p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;  
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot; 
xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;   
    xmlns:jee=&quot;http://www.springframework.org/schema/jee&quot;  
    xmlns:tx=&quot;http://www.springframework.org/schema/tx&quot;  
    &lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;&lt;span style=&quot;color:#990000;&quot;&gt;xmlns:dubbo=&quot;http://code.alibabatech.com/schema/dubbo&quot;&lt;/span&gt;&lt;/span&gt;  
    xmlns:context=&quot;http://www.springframework.org/schema/context&quot;  
    xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.1.xsd  
    http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-3.1.xsd  
    http://www.springframework.org/schema/jee http://www.springframework.org/schema/jee/spring-jee-3.1.xsd  
    &lt;span style=&quot;color:#990000;&quot;&gt;http://code.alibabatech.com/schema/dubbo http://code.alibabatech.com/schema/dubbo/dubbo.xsd&lt;/span&gt;  
    http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.1.xsd&quot;  
    default-lazy-init=&quot;false&quot; &gt;  

   &lt;dubbo:application name=&quot;dubbo_consumer&quot;&gt;&lt;/dubbo:application&gt;  
   &lt;!-- 使用zookeeper注册中心暴露服务地址 --&gt;    
   &lt;dubbo:registry address=&quot;zookeeper://192.168.74.129:2181&quot; check=&quot;false&quot;&gt;&lt;/dubbo:registry&gt;   
     &lt;!-- 要引用的服务 --&gt;    
   &lt;dubbo:reference interface=&quot;cn.test.dubbo.registry.service.TestRegistryService&quot; id=&quot;testRegistryService&quot;&gt;&lt;/dubbo:reference&gt;  
&lt;/beans&gt;         
</code></pre><p>说明：<br>dubbo:reference 的一些属性的说明：<br>      1）interface调用的服务接口<br>      2）check 启动时检查提供者是否存在，true报错，false忽略<br>      3）registry 从指定注册中心注册获取服务列表，在多个注册中心时使用，值为<dubbo:registry>的id属性，多个注册中心ID用逗号分隔<br>      4）loadbalance 负载均衡策略，可选值：random,roundrobin,leastactive，分别表示：随机，轮循，最少活跃调用 </dubbo:registry></p>
<p>(4)项目启动，Dubbo管理页面，能看到消费者，如图所示：  </p>
<p><img src="http://img.blog.csdn.net/20141114081750156?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY29uZ2Nvbmc2OA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="">  </p>
<p>(5)然后访问消费者项目，Controller层能像调用本地一样调用服务的具体实现，如图所示：</p>
<p> <img src="http://img.blog.csdn.net/20141114081749612?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY29uZ2Nvbmc2OA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="">  </p>
<p>Dubbo提供了多种容错方案,包括负载均衡这些，如图所示：  </p>
<p><img src="http://img.blog.csdn.net/20141114081802935?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY29uZ2Nvbmc2OA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""></p>

      
    </div>

    <div>
      
        
      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      

      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="Ciel City" />
          <p class="site-author-name" itemprop="name">Ciel City</p>
          <p class="site-description motion-element" itemprop="description">Growth is the accumulation of</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">1</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          

          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#介绍Dubbo背景"><span class="nav-number">1.</span> <span class="nav-text">介绍Dubbo背景</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-当服务越来越多时，服务URL配置管理变得非常困难，F5硬件负载均衡器的单点压力也越来越大。"><span class="nav-number">1.1.</span> <span class="nav-text">(1) 当服务越来越多时，服务URL配置管理变得非常困难，F5硬件负载均衡器的单点压力也越来越大。</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-当进一步发展，服务间依赖关系变得错踪复杂，甚至分不清哪个应用要在哪个应用之前启动，架构师都不能完整的描述应用的架构关系。"><span class="nav-number">1.2.</span> <span class="nav-text">(2) 当进一步发展，服务间依赖关系变得错踪复杂，甚至分不清哪个应用要在哪个应用之前启动，架构师都不能完整的描述应用的架构关系。</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-接着，服务的调用量越来越大，服务的容量问题就暴露出来，这个服务需要多少机器支撑？什么时候该加机器？"><span class="nav-number">1.3.</span> <span class="nav-text">(3) 接着，服务的调用量越来越大，服务的容量问题就暴露出来，这个服务需要多少机器支撑？什么时候该加机器？</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Dubbo的简介"><span class="nav-number">2.</span> <span class="nav-text">Dubbo的简介</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#节点角色说明："><span class="nav-number">2.1.</span> <span class="nav-text">节点角色说明：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#调用关系说明："><span class="nav-number">2.2.</span> <span class="nav-text">调用关系说明：</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Dubbo与Zookeeper、SpringMVC整合使用"><span class="nav-number">3.</span> <span class="nav-text">Dubbo与Zookeeper、SpringMVC整合使用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#第一步：在Linux上安装Zookeeper"><span class="nav-number">3.1.</span> <span class="nav-text">第一步：在Linux上安装Zookeeper</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#第二步：配置dubbo-admin的管理页面，方便我们管理页面"><span class="nav-number">3.2.</span> <span class="nav-text">第二步：配置dubbo-admin的管理页面，方便我们管理页面</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#第三步：SpringMVC与Dubbo的整合，这边使用的Maven的管理项目"><span class="nav-number">3.3.</span> <span class="nav-text">第三步：SpringMVC与Dubbo的整合，这边使用的Maven的管理项目</span></a></li></ol></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ciel City</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.1"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  



  



  
  
  

  

  

</body>
</html>
